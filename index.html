<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>ROW Marketing - Task Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{--primary:#007bff;--success:#28a745;--danger:#dc3545;--warning:#ffc107;--muted:#6c757d;--bg:#f4f6f9;}
body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:var(--bg);}
header{background:linear-gradient(90deg,#007bff,#00aaff);color:#fff;padding:10px 16px;display:flex;justify-content:space-between;align-items:center;}
header h1{margin:0;font-size:18px;font-weight:600}
nav button{background:#fff;color:var(--primary);border:0;border-radius:18px;padding:6px 10px;margin-left:6px;cursor:pointer;font-weight:600}
nav button:hover{background:#e9f3ff}
main{padding:14px;max-width:1100px;margin:auto;}
.top-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:12px;}
.today-att{flex:1;background:#fff;padding:8px 12px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.06);}
.today-att h3{margin:0 0 6px 0;font-size:14px}
.badge{display:inline-block;margin:2px 4px;padding:4px 8px;border-radius:999px;font-size:12px;color:#fff}
.present{background:var(--success)} .halfday{background:var(--warning);color:#000}
.absent{background:var(--danger)} .leave{background:var(--muted)}
.summary{display:flex;gap:8px;}
.card{background:#fff;border-radius:10px;padding:8px 12px;box-shadow:0 2px 6px rgba(0,0,0,.06);text-align:center;min-width:90px}
.card h4{margin:0;font-size:12px;color:#444}
.card span{display:block;font-size:18px;font-weight:700;margin-top:4px}
.charts-row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px;}
.chart-box{flex:1;background:#fff;padding:12px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.06);}
.chart-box h4{margin:0 0 8px 0;font-size:14px}
#statusChart{max-width:220px!important;max-height:220px!important;margin:auto;}
#teamChart{width:100%!important;max-height:260px!important}
.task-form{background:#fff;border-radius:10px;padding:10px;box-shadow:0 2px 6px rgba(0,0,0,.06);margin-bottom:12px;}
.task-form h3{margin:0 0 6px 0;font-size:16px}
.task-form .row{display:flex;flex-wrap:wrap;gap:8px}
input,select,button{padding:8px;border:1px solid #ddd;border-radius:6px}
button.save-btn{background:var(--primary);color:#fff;border:0;font-weight:600;cursor:pointer}
button.save-btn:hover{opacity:.9}
table{width:100%;border-collapse:collapse;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.06)}
th,td{padding:8px;border:1px solid #eee;text-align:center}
th{background:var(--primary);color:#fff}
.status-btn{padding:6px 10px;border:0;border-radius:8px;color:#fff;cursor:pointer;font-weight:600}
.pending{background:var(--danger)} .inprogress{background:var(--warning);color:#000} .completed{background:var(--success)}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:1000}
.modal-content{background:#fff;margin:6% auto;padding:16px;border-radius:10px;width:520px;max-width:95vw;box-shadow:0 10px 30px rgba(0,0,0,.25)}
.close{float:right;cursor:pointer;font-weight:700}
</style>
</head>
<body>

<header>
  <h1>ROW Marketing - Task Portal</h1>
  <nav>
    <button onclick="openModal('clientModal')">Clients</button>
    <button onclick="openModal('teamModal')">Team</button>
    <button onclick="openModal('attendanceModal'); onOpenAttendance();">Attendance</button>
  </nav>
</header>

<main>
  <div class="top-row">
    <div class="today-att"><h3>üìÖ Today‚Äôs Attendance</h3><div id="todayAttendance"></div></div>
    <div class="summary">
      <div class="card"><h4>‚úÖ Completed</h4><span id="completedCount">0</span></div>
      <div class="card"><h4>‚è≥ In Progress</h4><span id="inProgressCount">0</span></div>
      <div class="card"><h4>‚ùå Pending</h4><span id="pendingCount">0</span></div>
    </div>
  </div>
  <div class="charts-row">
    <div class="chart-box"><h4>Task Status</h4><canvas id="statusChart"></canvas></div>
    <div class="chart-box"><h4>Team Tasks</h4><canvas id="teamChart"></canvas></div>
  </div>
  <div class="task-form">
    <h3>Add / Edit Task</h3>
    <div class="row">
      <input type="hidden" id="editIndex">
      <select id="clientName"></select>
      <input type="text" id="taskName" placeholder="Task Name">
      <select id="assignedTo"></select>
      <select id="statusSelect">
        <option value="pending">Pending</option>
        <option value="inprogress">In Progress</option>
        <option value="completed">Completed</option>
      </select>
      <input type="date" id="dueDate">
      <select id="repeatSelect">
        <option value="">No Repeat</option>
        <option value="daily">Daily</option>
        <option value="weekly">Weekly</option>
        <option value="monthly">Monthly</option>
      </select>
      <button class="save-btn" onclick="addOrUpdateTask()">Save</button>
    </div>
  </div>
  <table id="taskTable">
    <thead>
      <tr><th>Client</th><th>Task</th><th>Assigned</th><th>Status</th><th>Due</th><th>Repeat</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</main>

<!-- Clients Modal -->
<div id="clientModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('clientModal')">√ó</span><h3>Manage Clients</h3><div style="display:flex;gap:8px;margin-bottom:8px"><input type="text" id="newClient" placeholder="Add new client" style="flex:1"><button onclick="addClient()">Add</button></div><table><tbody id="clientTable"></tbody></table></div></div>
<!-- Team Modal -->
<div id="teamModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('teamModal')">√ó</span><h3>Manage Team</h3><div style="display:flex;gap:8px;margin-bottom:8px"><input type="text" id="newTeam" placeholder="Add new member" style="flex:1"><button onclick="addTeam()">Add</button></div><table><tbody id="teamTable"></tbody></table></div></div>
<!-- Attendance Modal -->
<div id="attendanceModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('attendanceModal')">√ó</span><h3>Manage Attendance</h3>
  <div style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:8px">
    <label>Date:</label><input type="date" id="attendanceDate" readonly>
    <label>Member:</label><select id="attendanceMember"></select>
    <label>Status:</label><select id="attendanceStatus"><option>Present</option><option>Absent</option><option>Leave</option><option>Half Day</option></select>
    <button onclick="saveSingleAttendance()">Save</button><span id="attendanceMsg" style="color:green;font-weight:700"></span>
  </div>
  <hr>
  <h4>üìä Monthly Report</h4>
  <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
    <label>Month:</label>
    <input type="month" id="reportMonth">
    <button onclick="downloadAttendance()">Download CSV</button>
  </div>
</div></div>

<!-- Firebase + App Logic -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

  // üîπ Replace with your Firebase config
  const firebaseConfig = {
    apiKey: "AbCdEfGhIjKlMnOpQrStUvWxYz123456789",
    authDomain: "row-task.firebaseapp.com",
    databaseURL: "https://row-task-default-rtdb.firebaseio.com",
    projectId: "row-task",
    storageBucket: "row-task.appspot.com",
    messagingSenderId: "1234567890",
    appId: "1:1234567890:web:abc123def456"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Data arrays
  let tasks=[],clients=[],team=[],attendance=[];

  // Load Data
  async function loadData(){
    try {
      const snapshot = await get(child(ref(db), "data"));
      if(snapshot.exists()){
        let d = snapshot.val();
        tasks = d.tasks || [];
        clients = d.clients || ["Client A"];
        team = d.team || ["Rohama","Fakhar","Mubashir"];
        attendance = d.attendance || [];
      } else {
        clients=["Client A"];
        team=["Rohama","Fakhar","Mubashir"];
        attendance=[];
      }
    } catch(e){
      console.error("Load error:", e);
      clients=["Client A"];
      team=["Rohama","Fakhar","Mubashir"];
      attendance=[];
    }
    loadDropdowns();renderTable();updateSummary();renderTodayAttendance();
  }

  // Save Data
  async function saveData(){
    try {
      await set(ref(db, "data"), {tasks, clients, team, attendance});
      console.log("‚úÖ Data saved");
    } catch(e){ console.error("Save error:", e); }
    updateSummary();renderTodayAttendance();
  }

  // ---- Functions ----
  function addOrUpdateTask(){let c=document.getElementById("clientName").value;let t=document.getElementById("taskName").value.trim();let a=document.getElementById("assignedTo").value;let s=document.getElementById("statusSelect").value;let d=document.getElementById("dueDate").value;let r=document.getElementById("repeatSelect").value;let idx=document.getElementById("editIndex").value;if(!c||!t||!a){alert("Fill all fields");return;}if(idx){tasks[idx]={client:c,task:t,assigned:a,status:s,due:d,repeat:r};}else{tasks.push({client:c,task:t,assigned:a,status:s,due:d,repeat:r});}document.getElementById("editIndex").value="";saveData();renderTable();}
  function editTask(i){let t=tasks[i];document.getElementById("clientName").value=t.client;document.getElementById("taskName").value=t.task;document.getElementById("assignedTo").value=t.assigned;document.getElementById("statusSelect").value=t.status;document.getElementById("dueDate").value=t.due||todayStr();document.getElementById("repeatSelect").value=t.repeat||"";document.getElementById("editIndex").value=i;}
  function deleteTask(i){if(confirm("Delete?")){tasks.splice(i,1);saveData();renderTable();}}
  function changeStatus(i){let s=tasks[i].status;tasks[i].status=s==="pending"?"inprogress":s==="inprogress"?"completed":"pending";saveData();renderTable();}
  function renderTable(){let tb=document.querySelector("#taskTable tbody");tb.innerHTML="";tasks.forEach((t,i)=>{tb.innerHTML+=`<tr><td>${t.client}</td><td>${t.task}</td><td>${t.assigned}</td><td><button class="status-btn ${t.status}" onclick="changeStatus(${i})">${statusText(t.status)}</button></td><td>${t.due||"-"}</td><td>${t.repeat||"-"}</td><td><button onclick="editTask(${i})">‚úè</button> <button onclick="deleteTask(${i})">üóë</button></td></tr>`;});}
  function updateSummary(){let p=tasks.filter(t=>t.status==="pending").length;let ip=tasks.filter(t=>t.status==="inprogress").length;let c=tasks.filter(t=>t.status==="completed").length;document.getElementById("pendingCount").textContent=p;document.getElementById("inProgressCount").textContent=ip;document.getElementById("completedCount").textContent=c;updateCharts(p,ip,c);}
  let statusChart,teamChart;
  function updateCharts(p,ip,c){if(statusChart)statusChart.destroy();statusChart=new Chart(document.getElementById("statusChart"),{type:"doughnut",data:{labels:["Pending","In Progress","Completed"],datasets:[{data:[p,ip,c],backgroundColor:["#dc3545","#ffc107","#28a745"]}]},options:{plugins:{legend:{display:false}}}});if(teamChart)teamChart.destroy();let members=team;let pendingCounts=members.map(m=>tasks.filter(t=>t.assigned===m && t.status==="pending").length);let inProgressCounts=members.map(m=>tasks.filter(t=>t.assigned===m && t.status==="inprogress").length);let completedCounts=members.map(m=>tasks.filter(t=>t.assigned===m && t.status==="completed").length);teamChart=new Chart(document.getElementById("teamChart"),{type:"bar",data:{labels:members,datasets:[{label:"Pending",data:pendingCounts,backgroundColor:"#dc3545"},{label:"In Progress",data:inProgressCounts,backgroundColor:"#ffc107"},{label:"Completed",data:completedCounts,backgroundColor:"#28a745"}]},options:{responsive:true,plugins:{legend:{position:"bottom"}},scales:{x:{stacked:true},y:{stacked:true,beginAtZero:true}}}});}
  function renderClients(){let tb=document.getElementById("clientTable");tb.innerHTML="";clients.forEach((c,i)=>tb.innerHTML+=`<tr><td>${c}</td><td><button onclick="deleteClient(${i})">üóë</button></td></tr>`);}
  function addClient(){let n=document.getElementById("newClient").value.trim();if(n&&!clients.includes(n)){clients.push(n);document.getElementById("newClient").value="";saveData();renderClients();loadDropdowns();}}
  function deleteClient(i){if(tasks.some(t=>t.client===clients[i])){alert("Client in use");return;}clients.splice(i,1);saveData();renderClients();loadDropdowns();}
  function renderTeam(){let tb=document.getElementById("teamTable");tb.innerHTML="";team.forEach((m,i)=>tb.innerHTML+=`<tr><td>${m}</td><td><button onclick="deleteTeam(${i})">üóë</button></td></tr>`);}
  function addTeam(){let n=document.getElementById("newTeam").value.trim();if(n&&!team.includes(n)){team.push(n);document.getElementById("newTeam").value="";saveData();renderTeam();loadDropdowns();}}
  function deleteTeam(i){if(tasks.some(t=>t.assigned===team[i])){alert("Member in use");return;}team.splice(i,1);saveData();renderTeam();loadDropdowns();}
  function onOpenAttendance(){document.getElementById("attendanceDate").value=todayStr();loadAttendanceMembers();}
  function loadAttendanceMembers(){let sel=document.getElementById("attendanceMember");sel.innerHTML=team.map(m=>`<option>${m}</option>`).join("");}
  function saveSingleAttendance(){let d=document.getElementById("attendanceDate").value;let m=document.getElementById("attendanceMember").value;let s=document.getElementById("attendanceStatus").value;let rec=attendance.find(a=>a.date===d&&a.member===m);if(rec){rec.status=s;}else{attendance.push({date:d,member:m,status:s});}saveData();document.getElementById("attendanceMsg").textContent="Saved ‚úÖ";setTimeout(()=>document.getElementById("attendanceMsg").textContent="",1200);}
  function renderTodayAttendance(){let today=todayStr();let box=document.getElementById("todayAttendance");box.innerHTML="";team.forEach(m=>{let rec=attendance.find(a=>a.date===today&&a.member===m);let st=rec?rec.status:"Absent";box.innerHTML+=`<span class="badge ${st.replace(" ","").toLowerCase()}">${m}: ${st}</span>`;});}
  function downloadAttendance(){let m=document.getElementById("reportMonth").value;if(!m){alert("Select month");return;}let rows=["Date,Member,Status"];attendance.filter(a=>a.date.startsWith(m)).forEach(a=>rows.push(`${a.date},${a.member},${a.status}`));let blob=new Blob([rows.join("\n")],{type:"text/csv"});let url=URL.createObjectURL(blob);let a=document.createElement("a");a.href=url;a.download="attendance.csv";a.click();URL.revokeObjectURL(url);}
  function loadDropdowns(){document.getElementById("clientName").innerHTML=clients.map(c=>`<option>${c}</option>`).join("");document.getElementById("assignedTo").innerHTML=team.map(m=>`<option>${m}</option>`).join("");}
  function todayStr(){let d=new Date();return d.toISOString().split("T")[0];}
  function statusText(s){return s==="pending"?"Pending":s==="inprogress"?"In Progress":"Completed";}
  function openModal(id){document.getElementById(id).style.display="block";}
  function closeModal(id){document.getElementById(id).style.display="none";}

  // Expose globally so HTML onclick works
  window.addOrUpdateTask=addOrUpdateTask;
  window.editTask=editTask;
  window.deleteTask=deleteTask;
  window.changeStatus=changeStatus;
  window.addClient=addClient;
  window.deleteClient=deleteClient;
  window.addTeam=addTeam;
  window.deleteTeam=deleteTeam;
  window.openModal=openModal;
  window.closeModal=closeModal;
  window.onOpenAttendance=onOpenAttendance;
  window.saveSingleAttendance=saveSingleAttendance;
  window.downloadAttendance=downloadAttendance;

  loadData();
</script>
</body>
</html>
