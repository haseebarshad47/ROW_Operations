<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>ROW Marketing - Task Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --primary: #007bff;
  --success: #28a745;
  --danger: #dc3545;
  --warning: #ffc107;
  --muted: #6c757d;
  --bg: #f4f6f9;
}
body {
  margin: 0;
  font-family: Segoe UI, Arial, sans-serif;
  background: var(--bg);
}
header {
  background: linear-gradient(90deg, #007bff, #00aaff);
  color: #fff;
  padding: 10px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
header h1 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
}
nav button {
  background: #fff;
  color: var(--primary);
  border: 0;
  border-radius: 18px;
  padding: 6px 10px;
  margin-left: 6px;
  cursor: pointer;
  font-weight: 600;
}
nav button:hover { background: #e9f3ff; }

main { padding: 14px; max-width: 1200px; margin: auto; }

/* Top Row */
.top-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  gap: 12px;
}
.today-att {
  flex: 1;
  background: #fff;
  padding: 8px 12px;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,.06);
}
.today-att h3 {
  margin: 0 0 6px 0;
  font-size: 14px;
}
.badge {
  display: inline-block;
  margin: 2px 4px;
  padding: 4px 8px;
  border-radius: 999px;
  font-size: 12px;
  color: #fff;
}
.present { background: var(--success) }
.halfday { background: var(--warning); color: #000 }
.absent { background: var(--danger) }
.leave { background: var(--muted) }

.summary { display: flex; gap: 8px; }
.card {
  background: #fff;
  border-radius: 10px;
  padding: 8px 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,.06);
  text-align: center;
  min-width: 90px;
}
.card h4 { margin: 0; font-size: 12px; color: #444 }
.card span {
  display: block;
  font-size: 18px;
  font-weight: 700;
  margin-top: 4px;
}

/* Task Form */
.task-form {
  background: #fff;
  border-radius: 10px;
  padding: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,.06);
  margin-bottom: 16px;
}
.task-form h3 { margin: 0 0 10px 0; font-size: 16px; }
.task-form .row { display: flex; flex-wrap: wrap; gap: 8px; }
.task-form input, .task-form select {
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 6px;
  flex: 1;
}
.task-form button {
  background: var(--primary);
  color: #fff;
  border: 0;
  font-weight: 600;
  cursor: pointer;
  padding: 8px 14px;
  border-radius: 6px;
}
.task-form button:hover { opacity: .9; }

/* Task Tables */
.section-title {
  font-size: 16px;
  margin: 18px 0 6px 0;
  font-weight: 600;
}
table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
  box-shadow: 0 2px 6px rgba(0,0,0,.06);
  margin-bottom: 12px;
}
th, td {
  padding: 8px;
  border: 1px solid #eee;
  text-align: center;
}
th {
  background: var(--primary);
  color: #fff;
}
.status-btn {
  padding: 6px 10px;
  border: 0;
  border-radius: 8px;
  color: #fff;
  cursor: pointer;
  font-weight: 600;
}
.pending { background: var(--danger) }
.inprogress { background: var(--warning); color: #000 }
.completed { background: var(--success) }

/* Charts */
.charts-row {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  margin-bottom: 12px;
}
.chart-box {
  flex: 1;
  background: #fff;
  padding: 12px;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,.06);
}
.chart-box h4 { margin: 0 0 8px 0; font-size: 14px; }
#statusChart { max-width: 220px!important; max-height: 220px!important; margin: auto; }
#teamChart { width: 100%!important; max-height: 260px!important; }

/* Modal */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.45);
  z-index: 1000;
}
.modal-content {
  background: #fff;
  margin: 6% auto;
  padding: 16px;
  border-radius: 10px;
  width: 520px;
  max-width: 95vw;
  box-shadow: 0 10px 30px rgba(0,0,0,.25);
}
.close { float: right; cursor: pointer; font-weight: 700; }

/* Top Performer */
.top-performer-box {
  background: #fff;
  border-radius: 10px;
  padding: 8px 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,.06);
  min-width: 200px;
}
.top-performer-box h4 { margin: 0; font-size: 14px; }
.top-performer-box span {
  font-weight: 700;
  color: var(--success);
  font-size: 16px;
}

@media(max-width:768px){
  .top-row { flex-direction: column; }
}
</style>
</head>
<body>

<header>
  <h1>ROW Marketing - Task Portal</h1>
  <nav>
    <button onclick="openModal('clientModal')">Clients</button>
    <button onclick="openModal('teamModal')">Team</button>
    <button onclick="openModal('attendanceModal'); onOpenAttendance();">Attendance</button>
  </nav>
</header>

<main>
  <!-- Top Row -->
  <div class="top-row">
    <div class="today-att">
      <h3>üìÖ Today‚Äôs Attendance</h3>
      <div id="todayAttendance"></div>
    </div>
    <div class="top-performer-box">
      <h4>üèÜ Top Performer</h4>
      <span id="topPerformerName">-</span>
    </div>
    <div class="summary">
      <div class="card"><h4>‚úÖ Completed</h4><span id="completedCount">0</span></div>
      <div class="card"><h4>‚è≥ In Progress</h4><span id="inProgressCount">0</span></div>
      <div class="card"><h4>‚ùå Pending</h4><span id="pendingCount">0</span></div>
    </div>
  </div>

  <!-- Task Form -->
  <div class="task-form">
    <h3>Add New Task</h3>
    <div class="row">
      <input type="hidden" id="editIndex">
      <select id="clientName"></select>
      <input type="text" id="taskName" placeholder="e.g., Design new ad creative">
      <select id="assignedTo"></select>
      <input type="date" id="dueDate">
      <select id="repeatSelect">
        <option value="">No Repeat</option>
        <option value="daily">Daily</option>
        <option value="weekly">Weekly</option>
        <option value="monthly">Monthly</option>
      </select>
      <select id="statusSelect">
        <option value="pending">Pending</option>
        <option value="inprogress">In Progress</option>
        <option value="completed">Completed</option>
      </select>
      <button onclick="addOrUpdateTask()">Add Task</button>
    </div>
    <div style="margin-top:10px;">
      <button style="background:var(--warning);color:#000;">‚ú® Suggest Tasks with AI</button>
    </div>
  </div>

  <!-- Overdue Table -->
  <div>
    <div class="section-title">üö® Overdue Tasks</div>
    <table id="overdueTable">
      <thead><tr><th>Client</th><th>Task</th><th>Assigned To</th><th>Status</th><th>Due Date</th><th>Repeat</th><th>Actions</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Upcoming Table -->
  <div>
    <div class="section-title">üìÖ Upcoming Tasks</div>
    <table id="upcomingTable">
      <thead><tr><th>Client</th><th>Task</th><th>Assigned To</th><th>Status</th><th>Due Date</th><th>Repeat</th><th>Actions</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Charts -->
  <div class="charts-row">
    <div class="chart-box"><h4>Task Status</h4><canvas id="statusChart"></canvas></div>
    <div class="chart-box"><h4>Team Tasks</h4><canvas id="teamChart"></canvas></div>
  </div>
</main>

<!-- Clients Modal -->
<div id="clientModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('clientModal')">√ó</span>
    <h3>Manage Clients</h3>
    <div style="display:flex;gap:8px;margin-bottom:8px">
      <input type="text" id="newClient" placeholder="Add new client" style="flex:1">
      <button onclick="addClient()">Add</button>
    </div>
    <table><tbody id="clientTable"></tbody></table>
  </div>
</div>

<!-- Team Modal -->
<div id="teamModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('teamModal')">√ó</span>
    <h3>Manage Team</h3>
    <div style="display:flex;gap:8px;margin-bottom:8px">
      <input type="text" id="newTeam" placeholder="Add new member" style="flex:1">
      <button onclick="addTeam()">Add</button>
    </div>
    <table><tbody id="teamTable"></tbody></table>
  </div>
</div>

<!-- Attendance Modal -->
<div id="attendanceModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('attendanceModal')">√ó</span>
    <h3>Manage Attendance</h3>
    <div style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:8px">
      <label>Date:</label><input type="date" id="attendanceDate" readonly>
      <label>Member:</label><select id="attendanceMember"></select>
      <label>Status:</label><select id="attendanceStatus"><option>Present</option><option>Absent</option><option>Leave</option><option>Half Day</option></select>
      <button onclick="saveSingleAttendance()">Save</button>
      <span id="attendanceMsg" style="color:green;font-weight:700"></span>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AbCdEfGhIjKlMnOpQrStUvWxYz123456789",
    authDomain: "row-task.firebaseapp.com",
    databaseURL: "https://row-task-default-rtdb.firebaseio.com",
    projectId: "row-task",
    storageBucket: "row-task.appspot.com",
    messagingSenderId: "1234567890",
    appId: "1:1234567890:web:abc123def456"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let tasks = [], clients = [], team = [], attendance = [];

  async function loadData(){
    try {
      const snapshot = await get(child(ref(db), "data"));
      if(snapshot.exists()){
        let d = snapshot.val();
        tasks = d.tasks || [];
        clients = d.clients || ["Client A"];
        team = d.team || ["Rohama","Fakhar","Mubashir"];
        attendance = d.attendance || [];
      } else {
        clients = ["Client A"];
        team = ["Rohama","Fakhar","Mubashir"];
        attendance = [];
      }
    } catch(e){
      console.error(e);
      clients=["Client A"];
      team=["Rohama","Fakhar","Mubashir"];
      attendance=[];
    }
    loadDropdowns();renderTables();updateSummary();renderTodayAttendance();updateTopPerformer();
  }

  async function saveData(){
    await set(ref(db, "data"), {tasks, clients, team, attendance});
    updateSummary();renderTables();renderTodayAttendance();updateTopPerformer();
  }

  function addOrUpdateTask(){
    let c=document.getElementById("clientName").value;
    let t=document.getElementById("taskName").value.trim();
    let a=document.getElementById("assignedTo").value;
    let d=document.getElementById("dueDate").value;
    let r=document.getElementById("repeatSelect").value;
    let s=document.getElementById("statusSelect").value;
    let idx=document.getElementById("editIndex").value;
    if(!c||!t||!a){alert("Fill all fields");return;}
    if(idx){
      tasks[idx]={client:c,task:t,assigned:a,due:d,repeat:r,status:s};
    } else {
      tasks.push({client:c,task:t,assigned:a,due:d,repeat:r,status:s});
    }
    document.getElementById("taskName").value="";
    document.getElementById("editIndex").value="";
    saveData();
  }

  function renderTables(){
    let overdue=document.querySelector("#overdueTable tbody");
    let upcoming=document.querySelector("#upcomingTable tbody");
    overdue.innerHTML="";upcoming.innerHTML="";
    let today=new Date().toISOString().split("T")[0];
    tasks.forEach((t,i)=>{
      let row=`<tr>
        <td>${t.client}</td>
        <td>${t.task}</td>
        <td>${t.assigned}</td>
        <td><button class="status-btn ${t.status}" onclick="changeStatus(${i})">${statusText(t.status)}</button></td>
        <td>${t.due}</td>
        <td>${t.repeat||"-"}</td>
        <td><button onclick="editTask(${i})">‚úè</button> <button onclick="deleteTask(${i})">üóë</button></td>
      </tr>`;
      if(t.due && t.due < today) overdue.innerHTML+=row;
      else upcoming.innerHTML+=row;
    });
  }

  function changeStatus(i){
    let s=tasks[i].status;
    tasks[i].status=s==="pending"?"inprogress":s==="inprogress"?"completed":"pending";
    saveData();
  }

  function editTask(i){
    let t=tasks[i];
    document.getElementById("clientName").value=t.client;
    document.getElementById("taskName").value=t.task;
    document.getElementById("assignedTo").value=t.assigned;
    document.getElementById("dueDate").value=t.due;
    document.getElementById("repeatSelect").value=t.repeat||"";
    document.getElementById("statusSelect").value=t.status;
    document.getElementById("editIndex").value=i;
  }

  function deleteTask(i){
    if(confirm("Delete task?")){
      tasks.splice(i,1);
      saveData();
    }
  }

  function updateSummary(){
    let p=tasks.filter(t=>t.status==="pending").length;
    let ip=tasks.filter(t=>t.status==="inprogress").length;
    let c=tasks.filter(t=>t.status==="completed").length;
    document.getElementById("pendingCount").textContent=p;
    document.getElementById("inProgressCount").textContent=ip;
    document.getElementById("completedCount").textContent=c;
    drawCharts();
    updateTopPerformer();
  }

  function updateTopPerformer(){
    let performerCounts = team.map(m => ({
      name: m,
      completed: tasks.filter(t => t.assigned === m && t.status === "completed").length
    }));
    performerCounts.sort((a,b) => b.completed - a.completed);
    let top = performerCounts[0];
    const nameEl = document.getElementById("topPerformerName");
    if (top && top.completed > 0) nameEl.textContent = `${top.name} (${top.completed})`;
    else nameEl.textContent = "-";
  }

  function loadDropdowns(){
    let cSel=document.getElementById("clientName");
    let aSel=document.getElementById("assignedTo");
    let attSel=document.getElementById("attendanceMember");
    cSel.innerHTML=clients.map(c=>`<option>${c}</option>`).join("");
    aSel.innerHTML=team.map(t=>`<option>${t}</option>`).join("");
    attSel.innerHTML=team.map(t=>`<option>${t}</option>`).join("");
    document.getElementById("dueDate").value=new Date().toISOString().split("T")[0];
  }

  function addClient(){
    let val=document.getElementById("newClient").value.trim();
    if(val&&!clients.includes(val)){
      clients.push(val);
      document.getElementById("newClient").value="";
      saveData();
    }
  }

  function addTeam(){
    let val=document.getElementById("newTeam").value.trim();
    if(val&&!team.includes(val)){
      team.push(val);
      document.getElementById("newTeam").value="";
      saveData();
    }
  }

  function openModal(id){ document.getElementById(id).style.display="block"; }
  function closeModal(id){ document.getElementById(id).style.display="none"; }

  function onOpenAttendance(){
    document.getElementById("attendanceDate").value=new Date().toISOString().split("T")[0];
  }

  function saveSingleAttendance(){
    let d=document.getElementById("attendanceDate").value;
    let m=document.getElementById("attendanceMember").value;
    let s=document.getElementById("attendanceStatus").value;
    let idx=attendance.findIndex(a=>a.date===d&&a.name===m);
    if(idx>=0) attendance[idx].status=s;
    else attendance.push({date:d,name:m,status:s});
    saveData();
    document.getElementById("attendanceMsg").textContent="‚úÖ Saved!";
    setTimeout(()=>document.getElementById("attendanceMsg").textContent="",2000);
  }

  function renderTodayAttendance(){
    let cont=document.getElementById("todayAttendance");
    cont.innerHTML="";
    let today=new Date().toISOString().split("T")[0];
    team.forEach(m=>{
      let rec=attendance.find(a=>a.date===today&&a.name===m);
      let status=rec?rec.status:"Absent";
      let cls=status.toLowerCase().replace(" ","");
      cont.innerHTML+=`<span class="badge ${cls}">${m}</span>`;
    });
  }

  function statusText(s){
    if(s==="pending") return "Pending";
    if(s==="inprogress") return "In Progress";
    return "Completed";
  }

  let statusChart,teamChart;
  function drawCharts(){
    let p=tasks.filter(t=>t.status==="pending").length;
    let ip=tasks.filter(t=>t.status==="inprogress").length;
    let c=tasks.filter(t=>t.status==="completed").length;
    let ctx=document.getElementById("statusChart");
    if(statusChart) statusChart.destroy();
    statusChart=new Chart(ctx,{
      type:"doughnut",
      data:{labels:["Pending","In Progress","Completed"],datasets:[{data:[p,ip,c],backgroundColor:["#dc3545","#ffc107","#28a745"]}]},
      options:{plugins:{legend:{display:true}}}
    });

    let teamData=team.map(m=>tasks.filter(t=>t.assigned===m).length);
    let ctx2=document.getElementById("teamChart");
    if(teamChart) teamChart.destroy();
    teamChart=new Chart(ctx2,{
      type:"bar",
      data:{labels:team,datasets:[{data:teamData,backgroundColor:"#007bff"}]},
      options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}
    });
  }

  loadData();
</script>
</body>
</html>
