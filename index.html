<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>ROW Marketing - Task Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* --- your CSS untouched --- */
:root{--primary:#007bff;--success:#28a745;--danger:#dc3545;--warning:#ffc107;--muted:#6c757d;--bg:#f4f6f9;}
body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:var(--bg);}
header{background:linear-gradient(90deg,#007bff,#00aaff);color:#fff;padding:10px 16px;display:flex;justify-content:space-between;align-items:center;}
header h1{margin:0;font-size:18px;font-weight:600}
nav button{background:#fff;color:var(--primary);border:0;border-radius:18px;padding:6px 10px;margin-left:6px;cursor:pointer;font-weight:600}
nav button:hover{background:#e9f3ff}
/* rest same */
</style>
</head>
<body>

<header>
  <h1>ROW Marketing - Task Portal</h1>
  <nav>
    <button onclick="openModal('clientModal')">Clients</button>
    <button onclick="openModal('teamModal')">Team</button>
    <button onclick="openModal('attendanceModal'); onOpenAttendance();">Attendance</button>
  </nav>
</header>

<main>
  <!-- your UI unchanged -->
  <div class="top-row">
    <div class="today-att"><h3>📅 Today’s Attendance</h3><div id="todayAttendance"></div></div>
    <div class="summary">
      <div class="card"><h4>✅ Completed</h4><span id="completedCount">0</span></div>
      <div class="card"><h4>⏳ In Progress</h4><span id="inProgressCount">0</span></div>
      <div class="card"><h4>❌ Pending</h4><span id="pendingCount">0</span></div>
    </div>
  </div>
  <div class="charts-row">
    <div class="chart-box"><h4>Task Status</h4><canvas id="statusChart"></canvas></div>
    <div class="chart-box"><h4>Team Tasks</h4><canvas id="teamChart"></canvas></div>
  </div>
  <div class="task-form">
    <h3>Add / Edit Task</h3>
    <div class="row">
      <input type="hidden" id="editIndex">
      <select id="clientName"></select>
      <input type="text" id="taskName" placeholder="Task Name">
      <select id="assignedTo"></select>
      <select id="statusSelect">
        <option value="pending">Pending</option>
        <option value="inprogress">In Progress</option>
        <option value="completed">Completed</option>
      </select>
      <input type="date" id="dueDate">
      <select id="repeatSelect">
        <option value="">No Repeat</option>
        <option value="daily">Daily</option>
        <option value="weekly">Weekly</option>
        <option value="monthly">Monthly</option>
      </select>
      <button class="save-btn" onclick="addOrUpdateTask()">Save</button>
    </div>
  </div>
  <table id="taskTable">
    <thead>
      <tr><th>Client</th><th>Task</th><th>Assigned</th><th>Status</th><th>Due</th><th>Repeat</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</main>

<!-- Clients Modal -->
<div id="clientModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('clientModal')">×</span><h3>Manage Clients</h3><div style="display:flex;gap:8px;margin-bottom:8px"><input type="text" id="newClient" placeholder="Add new client" style="flex:1"><button onclick="addClient()">Add</button></div><table><tbody id="clientTable"></tbody></table></div></div>
<!-- Team Modal -->
<div id="teamModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('teamModal')">×</span><h3>Manage Team</h3><div style="display:flex;gap:8px;margin-bottom:8px"><input type="text" id="newTeam" placeholder="Add new member" style="flex:1"><button onclick="addTeam()">Add</button></div><table><tbody id="teamTable"></tbody></table></div></div>
<!-- Attendance Modal -->
<div id="attendanceModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('attendanceModal')">×</span><h3>Manage Attendance</h3><div style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:8px"><label>Date:</label><input type="date" id="attendanceDate" readonly><label>Member:</label><select id="attendanceMember"></select><label>Status:</label><select id="attendanceStatus"><option>Present</option><option>Absent</option><option>Leave</option><option>Half Day</option></select><button onclick="saveSingleAttendance()">Save</button><span id="attendanceMsg" style="color:green;font-weight:700"></span></div></div></div>

<!-- ✅ Firebase + App Logic -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, get, set, child } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  // 🔑 Your Firebase config
 // 🔹 Replace with your Firebase config
const firebaseConfig = {
  apiKey: "AbCdEfGhIjKlMnOpQrStUvWxYz123456789",
  authDomain: "row-task.firebaseapp.com",
  databaseURL: "https://row-task-default-rtdb.firebaseio.com",
  projectId: "row-task",
  storageBucket: "row-task.appspot.com",
  messagingSenderId: "1234567890",
  appId: "1:1234567890:web:abc123def456"
};


  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // ---------- Variables ----------
  let tasks=[],clients=[],team=[],attendance=[];

  // ---------- Load from Firebase ----------
  async function loadData(){
    try{
      const snapshot = await get(child(ref(db), "portalData"));
      if(snapshot.exists()){
        const d = snapshot.val();
        tasks=d.tasks||[];
        clients=d.clients||["Client A"];
        team=d.team||["Rohama","Fakhar","Mubashir"];
        attendance=d.attendance||[];
      } else {
        clients=["Client A"];
        team=["Rohama","Fakhar","Mubashir"];
        attendance=[];
      }
    }catch(e){
      console.error("Load error", e);
      clients=["Client A"];
      team=["Rohama","Fakhar","Mubashir"];
      attendance=[];
    }
    loadDropdowns();
    renderTable();
    updateSummary();
    renderTodayAttendance();
  }

  // ---------- Save to Firebase ----------
  async function saveData(){
    try{
      await set(ref(db,"portalData"),{tasks,clients,team,attendance});
    }catch(e){ console.error("Save error", e); }
    updateSummary();
    renderTodayAttendance();
  }

  // ---------- Your Existing Functions (unchanged) ----------
  window.addOrUpdateTask=function(){let c=document.getElementById("clientName").value;let t=document.getElementById("taskName").value.trim();let a=document.getElementById("assignedTo").value;let s=document.getElementById("statusSelect").value;let d=document.getElementById("dueDate").value;let r=document.getElementById("repeatSelect").value;let idx=document.getElementById("editIndex").value;if(!c||!t||!a){alert("Fill all fields");return;}if(idx){tasks[idx]={client:c,task:t,assigned:a,status:s,due:d,repeat:r};}else{tasks.push({client:c,task:t,assigned:a,status:s,due:d,repeat:r});}document.getElementById("editIndex").value="";saveData();renderTable();}

  window.editTask=function(i){let t=tasks[i];document.getElementById("clientName").value=t.client;document.getElementById("taskName").value=t.task;document.getElementById("assignedTo").value=t.assigned;document.getElementById("statusSelect").value=t.status;document.getElementById("dueDate").value=t.due||todayStr();document.getElementById("repeatSelect").value=t.repeat||"";document.getElementById("editIndex").value=i;}
  window.deleteTask=function(i){if(confirm("Delete?")){tasks.splice(i,1);saveData();renderTable();}}
  window.changeStatus=function(i){let s=tasks[i].status;tasks[i].status=s==="pending"?"inprogress":s==="inprogress"?"completed":"pending";saveData();renderTable();}
  function renderTable(){let tb=document.querySelector("#taskTable tbody");tb.innerHTML="";tasks.forEach((t,i)=>{tb.innerHTML+=`<tr><td>${t.client}</td><td>${t.task}</td><td>${t.assigned}</td><td><button class="status-btn ${t.status}" onclick="changeStatus(${i})">${statusText(t.status)}</button></td><td>${t.due||"-"}</td><td>${t.repeat||"-"}</td><td><button onclick="editTask(${i})">✏</button> <button onclick="deleteTask(${i})">🗑</button></td></tr>`;});}
  function updateSummary(){let p=tasks.filter(t=>t.status==="pending").length;let ip=tasks.filter(t=>t.status==="inprogress").length;let c=tasks.filter(t=>t.status==="completed").length;document.getElementById("pendingCount").textContent=p;document.getElementById("inProgressCount").textContent=ip;document.getElementById("completedCount").textContent=c;updateCharts(p,ip,c);}
  let statusChart,teamChart;
  function updateCharts(p,ip,c){if(statusChart)statusChart.destroy();statusChart=new Chart(document.getElementById("statusChart"),{type:"doughnut",data:{labels:["Pending","In Progress","Completed"],datasets:[{data:[p,ip,c],backgroundColor:["#dc3545","#ffc107","#28a745"]}]},options:{plugins:{legend:{display:false}}}});if(teamChart)teamChart.destroy();let members=team;let pendingCounts=members.map(m=>tasks.filter(t=>t.assigned===m && t.status==="pending").length);let inProgressCounts=members.map(m=>tasks.filter(t=>t.assigned===m && t.status==="inprogress").length);let completedCounts=members.map(m=>tasks.filter(t=>t.assigned===m && t.status==="completed").length);teamChart=new Chart(document.getElementById("teamChart"),{type:"bar",data:{labels:members,datasets:[{label:"Pending",data:pendingCounts,backgroundColor:"#dc3545"},{label:"In Progress",data:inProgressCounts,backgroundColor:"#ffc107"},{label:"Completed",data:completedCounts,backgroundColor:"#28a745"}]},options:{responsive:true,plugins:{legend:{position:"bottom"}},scales:{x:{stacked:true},y:{stacked:true,beginAtZero:true}}}});}
  function renderClients(){let tb=document.getElementById("clientTable");tb.innerHTML="";clients.forEach((c,i)=>tb.innerHTML+=`<tr><td>${c}</td><td><button onclick="deleteClient(${i})">🗑</button></td></tr>`);}
  window.addClient=function(){let n=document.getElementById("newClient").value.trim();if(n&&!clients.includes(n)){clients.push(n);document.getElementById("newClient").value="";saveData();renderClients();loadDropdowns();}}
  window.deleteClient=function(i){if(tasks.some(t=>t.client===clients[i])){alert("Client in use");return;}clients.splice(i,1);saveData();renderClients();loadDropdowns();}
  function renderTeam(){let tb=document.getElementById("teamTable");tb.innerHTML="";team.forEach((m,i)=>tb.innerHTML+=`<tr><td>${m}</td><td><button onclick="deleteTeam(${i})">🗑</button></td></tr>`);}
  window.addTeam=function(){let n=document.getElementById("newTeam").value.trim();if(n&&!team.includes(n)){team.push(n);document.getElementById("newTeam").value="";saveData();renderTeam();loadDropdowns();}}
  window.deleteTeam=function(i){if(tasks.some(t=>t.assigned===team[i])){alert("Member in use");return;}team.splice(i,1);saveData();renderTeam();loadDropdowns();}
  window.onOpenAttendance=function(){document.getElementById("attendanceDate").value=todayStr();loadAttendanceMembers();}
  function loadAttendanceMembers(){let sel=document.getElementById("attendanceMember");sel.innerHTML=team.map(m=>`<option>${m}</option>`).join("");}
  window.saveSingleAttendance=function(){let d=document.getElementById("attendanceDate").value;let m=document.getElementById("attendanceMember").value;let s=document.getElementById("attendanceStatus").value;let rec=attendance.find(a=>a.date===d&&a.member===m);if(rec){rec.status=s;}else{attendance.push({date:d,member:m,status:s});}saveData();document.getElementById("attendanceMsg").textContent="Saved ✅";setTimeout(()=>document.getElementById("attendanceMsg").textContent="",1200);}
  function renderTodayAttendance(){let today=todayStr();let box=document.getElementById("todayAttendance");box.innerHTML="";team.forEach(m=>{let rec=attendance.find(a=>a.date===today&&a.member===m);let st=rec?rec.status:"Absent";box.innerHTML+=`<span class="badge ${st.replace(" ","").toLowerCase()}">${m}: ${st}</span>`;});}
  function loadDropdowns(){document.getElementById("clientName").innerHTML=clients.map(c=>`<option>${c}</option>`).join("");document.getElementById("assignedTo").innerHTML=team.map(m=>`<option>${m}</option>`).join("");}
  function statusText(s){return s==="pending"?"Pending":s==="inprogress"?"In Progress":"Completed";}
  function todayStr(){return new Date().toISOString().split("T")[0];}

  // Init
  (async function init(){await loadData();document.getElementById("dueDate").value=todayStr();})();

  window.openModal=function(id){document.getElementById(id).style.display="block";}
  window.closeModal=function(id){document.getElementById(id).style.display="none";}
</script>

</body>
</html>

